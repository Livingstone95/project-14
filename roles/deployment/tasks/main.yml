---
# tasks file for deployment
- name: install httpd
  ansible.builtin.yum:
      name: httpd
      state: present

- name: start and enable httpd
  ansible.builtin.service:
     name: httpd
     state: started 
     enabled: yes


- name: install PHP and it dependencies
  ansible.builtin.yum:
    name:
      - php 
      - php-mysqlnd
      - php-gd 
      - php-curl
      - zip
      - wget
    state: present


- name: Download the artifact from artifactory
  get_url:  
    url:  http://3.126.249.237:8082/artifactory/David/php-todo
    dest:  /home/ec2-user/
    url_username: admin
    url_password: AP8Ayte6jRDe9c4YrymgceSvD2r

- name: unzip the artifacts
  ansible.builtin.unarchive:
    src: /home/ec2-user/
    dest: /var/www/html/ 
    remote_src: yes

- name: remove httpd default page 
  ansible.builtin.file:
    path: /etc/sites-enabled/default
    state: absent
  notify:  Restart httpd


 